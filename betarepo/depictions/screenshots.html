<!DOCTYPE html>
<html>
<head>
    <title>Depiction</title>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />	
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0"/>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <base target="_blank"/>
    <!--link rel="stylesheet" type="text/css" id="stylesheet" href="css/ios78.css"-->
	<link rel="stylesheet" type="text/css" id="stylesheet" href="themes/glypho/css/styles.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.querystring.js"></script>
    <script type="text/javascript">
	
	bundleid = $.QueryString['p'];	
	
    var contentBlocks = 	{
		"screenshotsList" : {"type":"list"  
								,"source" :"package>screenshots>screenshot"
								,"panel":"#screenshotsPanel"
								,"render":function(data){
									var imgtag = '<img class="shot" src="'+bundleid+'/screenshots/'+$(data).find('image').text()+'">';
									console.log(imgtag);
									return imgtag
								}
							}
    }
	
	function showDepictionInfo(xml) {
		document.title = $(xml).find("package>name").text();
		var version = $(xml).find("package>version").text();
	
		$.each(contentBlocks, function (key,contentInfo){
			
			/*
			if (key=='changesList') {
				contentInfo.source=contentInfo.source.replace(/{VERSION}/i,version);
			}
			*/
			switch(contentInfo.type) {
				case "list":
					var list = $(xml).find(contentInfo.source);
					if (list.size()==0) {
						$(contentInfo.panel).hide(); //hide panel if 
					} else {
						if (!key) {return}
						$.each(list, function(index,value){
							var item = $(value).text()
							if (contentInfo.render) {
								item = contentInfo.render(value);
							}
							$("#"+key).append('<li><p>'+item+'</p></li>')
						});
					}
					break;
				case "text":
					if (!key) {return}
					var content = $(xml).find(contentInfo.source).text();
					if (contentInfo.render) {
						content = contentInfo.render($(xml).find(contentInfo.source))
					}
					$("#"+key).html(content)
					
					break;
				case "attribute":
					if (!key) {return}
					var findAttr = $("#"+key).attr(contentInfo.findAttribute);
					var reg      = new RegExp(contentInfo.findValue,"gi");
					var repl     = $(xml).find(contentInfo.source).text();
					var newValue = findAttr.replace( reg, repl )
					$("#"+key).attr(contentInfo.findAttribute, newValue)
					break;
			}//switch
		}); //each
	}
	
    jQuery( document ).ready(function() {
        jQuery.ajax({
            type    : "GET",
            dataType: "xml",
            url     : (bundleid+"/info.xml"),
            success : showDepictionInfo,
			cache   : false,
            error: function() {
                $("#packageInformation").hide();
                $("#packageError").show();
            }
        }); //ajax
    }); // ready
    </script>
</head>

<body>
	<div id="packageInformation">
	
		<div id="screenshotsPanel">
			<h2>Screenshots</h2>
			<ul id="screenshotsList"></ul>
		</div>
		
	</div>
	<div id="packageError" style="display:none">
		<h2>Error</h2>
		<ul>
			<li><p>Information for this package is not available or not hosted on this repo.</p></li>
		</ul>
	</div>
	<div id="packageContact">
		<h2>Contact</h2>
		<ul>
			<li><a class="withIcon" id="twitterLink" href="https://twitter.com/supermamon">@supermamon</a></li>
			<li><a class="withIcon" id="webLink" href="https://github.com/supermamon">Github</a></li>
			<li><a class="withIcon" id="paypalLink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=BPQNBXPYB56HL&lc=US&item_name=Send%20love%20to%20@supermamon&currency_code=USD&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted">Contribute with Paypal</a></li>
		</ul>
	</div>
</body>
</html>
